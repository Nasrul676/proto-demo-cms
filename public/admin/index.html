<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Panel - Mas Nasrul Dev</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <script>
  // Fungsi untuk mengecek token secara berulang sampai widget siap
  const checkTokenAndOpenModal = () => {
    if (window.netlifyIdentity) {
      const hash = window.location.hash;
      if (hash.includes('invite_token') || hash.includes('confirmation_token')) {
        console.log("Token terdeteksi, membuka modal...");
        // Beri jeda sedikit agar widget benar-benar siap render
        setTimeout(() => {
          window.netlifyIdentity.open();
        }, 800);
      }
    }
  };

  // Jalankan saat script Identity terinisialisasi
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        checkTokenAndOpenModal();
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/";
        });
      }
    });
  } else {
    // Cadangan: jika init terlewat, jalankan saat window load
    window.addEventListener('load', checkTokenAndOpenModal);
  }
</script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>
</html>